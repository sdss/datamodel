# Data Model: rsAllocationFinal


Allocation for each field in this robotstrategy run (version for targetdb load)


## Contents
- [Basic Information](#basic-information)
- [Changelog](#changelog)
- [Example HDUS List](#example-hdus-list)
- [Notes](#notes)

---

## Basic Information
Allocation for each field in this robostrategy run (version for targetdb load). Produced by the robostrategy script final_allocation. This differs from the intermediate version (rsAllocation) because it splits mixed cadences into individual entries. If a field is split into two entries, each entry has the same fieldid but each entry has a different cadence. For example, a field with fieldid=10 and cadence=mixed2_single_10x1 will be split into two entries, both with fieldid=10, one with cadence=mixed2_single_2x1 (two dark exposures) and one with cadence=bright_single_8x1 (the bright exposures from mixed2_single_10x1). The exposure range in the rsFieldAssignmentsFinal file is provided for each entry. The fieldid is also changed (the original is stored as rs_fieldid here).

### Naming Convention
$ROBOSTRATEGY_DATA/allocations/[PLAN]/final/rsAllocationFinal-[PLAN]-[OBSERVATORY].fits

### Releases
WORK

### Enviroments
ROBOSTRATEGY_DATA

### Approximate Size
1 GB

### File Type
FITS

### Generated by Product
robostrategy

### Is a VAC
False

### HDUS List for release WORK
  - [HDU0: PRIMARY](#hdu0-primary)
  - [HDU1: ALLOCATE](#hdu1-allocate)
  - [HDU2: SLOTS](#hdu2-slots)
  - [HDU3: FIELDS](#hdu3-fields)
  - [HDU4: FSLOTS](#hdu4-fslots)
  - [HDU5: OPTIONS](#hdu5-options)
  - [HDU6: CARTONS](#hdu6-cartons)
  - [HDU7: CADENCES](#hdu7-cadences)

---

## Changelog
Describes changes to the datamodel product and/or file structure from one release to another

---
## Example HDUS List

### HDU0: PRIMARY
Primary header

#### HDU Type: IMAGE
#### HDU Size:  0 bytes

##### Header Table Caption for HDU0
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True | file does conform to FITS standard |
| BITPIX | 16 | number of bits per data pixel |
| NAXIS | 0 | number of data axes |
| EXTEND | True | FITS dataset may contain extensions |
| COMMENT |   FITS (Flexible Image Transport System) format is defined in 'Astronomy |  |
| COMMENT |   and Astrophysics', volume 376, page 359; bibcode: 2001A&A...376..359H |  |



### HDU1: ALLOCATE
Allocation of cadence to each field

#### HDU Type: BINARY TABLE
#### HDU Size:  2 MB


##### Binary Table Caption for HDU1
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | fieldid | int32 |  | field id number |
 | racen | float64 | deg | RA J2000 of field center |
 | deccen | float64 | deg | Dec J2000 of field center |
 | cadence | char[30] |  | Cadence name allocated |
 | nallocated | int32 |  | Number of designs allocated for future |
 | nallocated_sb | int32[2] |  | Number of designs allocated for future in each sky brightness |
 | nallocated_full | int32 |  | Number of designs allocated over full survey |
 | nallocated_full_sb | int32[2] |  | Number of designs allocated over full survey in each sky brightness |
 | needed | int32 |  | Number of designs needed over full survey for allocated cadence |
 | needed_sb | int32[2] |  | Number of designs already observed for allocated cadence in each sky brightness |
 | filled | int32 |  | Number of designs already observed for allocated cadence |
 | allocated_exposures_done | int32[100] |  | Indices of designs in allocated cadence that were completed already |
 | original_exposures_done | int32[100] |  | Indices of designs in original cadence that were completed already |
 | xfactor | float32[24, 2] |  | Cost factor for field in each sky brightness / LST slot |
 | slots_exposures | float32[24, 2] |  | Exposures allocated to each sky brightness / LST slot |
 | slots_time | float32[24, 2] | hours | Time allocated to each sky brightness / LST slot |
 | iexpst | int32 |  | starting exposure (0-indexed) in rsFieldAssignmentsFinal file |
 | iexpnd | int32 |  | ending exposure (0-indexed) in rsFieldAssignmentsFinal file |
 | split | int32 |  | 1 if this fieldid is split into multiple entries, 0 otherwise |
 | rs_fieldid | int32 |  | Original field identifier (i.e. corresponding one in rsAllocation file) |



### HDU2: SLOTS
Binary image of hours per LST and sky brightness slot (from rsSlots file)

#### HDU Type: IMAGE
#### HDU Size:  192 bytes

##### Header Table Caption for HDU2
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True | file does conform to FITS standard |
| BITPIX | -32 | number of bits per data pixel |
| NAXIS | 2 | number of data axes |
| NAXIS1 | 2 | length of data axis 1 |
| NAXIS2 | 24 | length of data axis 2 |
| EXTEND | True | FITS dataset may contain extensions |
| COMMENT |   FITS (Flexible Image Transport System) format is defined in 'Astronomy |  |
| COMMENT |   and Astrophysics', volume 376, page 359; bibcode: 2001A&A...376..359H |  |
| STRATVER | 1.0.5 | version of robostrategy |
| SCHEDVER | 0.9.1 | version of roboscheduler |
| NLST | 24 | number of LST bins |
| DURATION | 0.3 | duration in hours of each slot considered |
| FCLEAR | 0.5 | Assumption for this observatory of clear fraction (not applied to numbers in image) |
| OBSERVAT | apo | Observatory, apo or lco |
| NSB | 2 | number of sky brightness bins |
| SB0 | 0.0 | edge 0 of sky brightness bins |
| SB1 | 0.35 | edge 1 of sky brightness bins |
| SB2 | 1.0 | edge 2 of sky brightness bins |



### HDU3: FIELDS
Binary table of fields (from rsFieldsRotated)

#### HDU Type: BINARY TABLE
#### HDU Size:  297 KB


##### Binary Table Caption for HDU3
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | fieldid | int32 |  | Field identifier |
 | racen | float64 | deg | RA Center (J2000) |
 | deccen | float64 | deg | Dec Center (J2000) |
 | radius | float32 | deg | Radius over which to output targets |
 | type | char[30] |  | Type of field (used for setting cadence and allocation choices) |
 | pa1 | float32 | deg | proposed position angle using algorithm 1 (mean bearing to neighboring fields) |
 | pa2 | float32 | deg | proposed position angle using algorithm 2 (bearing to furthest neighboring field) |
 | iexpst | int32 |  | starting exposure (0-indexed) in rsFieldAssignmentsFinal file |
 | iexpnd | int32 |  | ending exposure (0-indexed) in rsFieldAssignmentsFinal file |
 | split | int32 |  | 1 if this fieldid is split into multiple entries, 0 otherwise |
 | rs_fieldid | int32 |  | Original field identifier (i.e. corresponding one in rsAllocation file) |



### HDU4: FSLOTS
Field slots information, with which slots can be used for a given field-cadence combination (from rsFieldSlots file)

#### HDU Type: BINARY TABLE
#### HDU Size:  221 MB


##### Binary Table Caption for HDU4
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | fieldid | int32 |  | Field identifier |
 | cadence | char[30] |  | Name of cadence |
 | raceN | float64 | deg | RA Center (J2000) |
 | deccen | float64 | deg | Dec Center (J2000) |
 | allowed | bool |  | Whether this cadence option is allowed |
 | filled_sb | int32[2] |  | Number of exposures already observed for each sky brightness type (in dark, bright order) |
 | allocated_exposures_done | int32[100] |  | Indices of designs in allocated cadence that were completed already |
 | original_exposures_done | int32[100] |  | Indices of designs in original cadence that were completed already |
 | needed_sb | int32[2] |  | Number of exposures needed for this cadence of each sky brightness type (in dark, bright order) |
 | slots | int32[24, 2] |  | 0 or 1 for whether the LST and skybrightness slot can be used for this field-cadence, based on sky brightness and airmass requirements. |



### HDU5: OPTIONS
Field-cadence options, and the value associated with each (from rsOptions file)

#### HDU Type: BINARY TABLE
#### HDU Size:  1 GB


##### Binary Table Caption for HDU5
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | fieldid | int32 |  | Field identifier |
 | racen | float64 | deg | RA Center (J2000) |
 | deccen | float64 | deg | Dec Center (J2000) |
 | ntargets | int32 |  | Total number of targets in rsFieldTargets file |
 | cadence | char[30] |  | Field cadence name |
 | nvisit | int32 |  | Number of exposures for this cadence |
 | nwithin | int32 |  | Number of targets reachable by a suitable positioner |
 | ngot | int32 |  | Number of targets gotten |
 | valuegot | float32 |  | Total value of targets gotten |
 | nwithin_pcd | int32[32] |  | Number of targets reachable by a suitable positioner, for each target cadence (see HDU7) |
 | ngot_pcd | int32[32] |  | Number of targets gotten for each target cadence (see HDU7) |
 | valuegot_pcd | float32[32] |  | Total value of targets gotten for each target cadence (see HDU7) |
 | nwithin_pct | int32[82] |  | Number of targets reachable by a suitable positioner, for each target carton (see HDU6) |
 | ngot_pct | int32[82] |  | Number of targets gotten for each target carton (see HDU6) |
 | valuegot_pct | float32[82] |  | Total value of targets gotten for each target carton (see HDU6) |



### HDU6: CARTONS
List of cartons for arrays in HDU5

#### HDU Type: BINARY TABLE
#### HDU Size:  4 KB


##### Binary Table Caption for HDU6
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | carton | char[50] |  | Carton names |



### HDU7: CADENCES
List of cadences for arrays in HDU5

#### HDU Type: BINARY TABLE
#### HDU Size:  1 KB


##### Binary Table Caption for HDU7
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | cadences | char[50] |  | Cadence name |



---
## Notes
None