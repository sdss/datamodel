# Data Model: silo_manga_stack_data


Datamodel for silo_manga_stack_data


## Contents
- [Basic Information](#basic-information)
- [Changelog](#changelog)
- [Example HDUS List](#example-hdus-list)
- [Notes](#notes)

---

## Basic Information
This file provides row-stacked-spectra (RSS), foreground subracted RSS (residuals), co-added residuals across exposures from the same fiber at the same dither position (stack), signal-to-noise (SN) for each stack, and spaxel CUBES constructed from each data type, in which sigma-clipping was applied to the stacked data to reject transient signals (see <a href="https://ui.adsabs.harvard.edu/abs/2018MNRAS.477..195T/abstract">Talbot et al. (2018)</a>, Talbot et al. in prep).

### Naming Convention
<code>manga_[PLATE]_[IFU]_stack_data\.fits, in which PLATE is the MaNGA plate and IFU is the MaNGA integral-field-unit.</code>

### Releases
DR17

### Enviroments
MANGA_SPECTRO_LENSING

### Approximate Size
1003 MB

### File Type
FITS

### Generated by Product
SILO

### Is a VAC
True

### HDUS List for release DR17
  - [HDU0: PRIMARY](#hdu0-primary)
  - [HDU1: INDIVIDUAL_EXPOSURE_REDUCTION](#hdu1-individual_exposure_reduction)
  - [HDU2: STACKED_REDUCTION](#hdu2-stacked_reduction)
  - [HDU3: WAVE](#hdu3-wave)
  - [HDU4: SPECRES](#hdu4-specres)
  - [HDU5: SPECRESD](#hdu5-specresd)
  - [HDU6: PRESPECRES](#hdu6-prespecres)
  - [HDU7: PRESPECRESD](#hdu7-prespecresd)
  - [HDU8: CUBE_INDIVIDUAL_FLUX](#hdu8-cube_individual_flux)
  - [HDU9: CUBE_INDIVIDUAL_MODEL](#hdu9-cube_individual_model)
  - [HDU10: CUBE_INDIVIDUAL_RESIDUALS](#hdu10-cube_individual_residuals)
  - [HDU11: CUBE_INDIVIDUAL_IVAR_RESCALED](#hdu11-cube_individual_ivar_rescaled)
  - [HDU12: CUBE_INDIVIDUAL_GAUSS_SN](#hdu12-cube_individual_gauss_sn)
  - [HDU13: CUBE_INDIVIDUAL_GAUSS_O2SN](#hdu13-cube_individual_gauss_o2sn)
  - [HDU14: CUBE_STACKED_RESIDUALS](#hdu14-cube_stacked_residuals)
  - [HDU15: CUBE_IVAR_RESCALED_STACKED](#hdu15-cube_ivar_rescaled_stacked)
  - [HDU16: CUBE_STACKED_GAUSS_SN](#hdu16-cube_stacked_gauss_sn)
  - [HDU17: CUBE_STACKED_GAUSS_O2SN](#hdu17-cube_stacked_gauss_o2sn)

---

## Changelog
Describes changes to the datamodel product and/or file structure from one release to another

---
## Example HDUS List

### HDU0: PRIMARY
Survey and MaNGA target information.

#### HDU Type: IMAGE
#### HDU Size:  0 bytes

##### Header Table Caption for HDU0
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True | conforms to FITS standard |
| BITPIX | 8 | array data type |
| NAXIS | 0 | number of array dimensions |
| EXTEND | True |  |
| AUTHOR | Michael Talbot | Creator of detection file |
| INSP | Michael Talbot | Detection inspector |
| SOURCE | SILO | SILO |
| SILO_VER | 1.0.3 | Version build of SILO |
| DRPVER | v3_1_1 | Data reduction pipeline version of RSS spectra |
| SAMPLING | LOG | Wavelength sampling type |
| SPECTRA | SINGLE AND COADDED | Type of spectra used from MaNGA files |
| OBJRA | 255.350049437 | Object right ascension |
| IFURA | 255.35005 | Right ascension of IFU center |
| OBJDEC | 37.3828022848 | Object declination |
| IFUDEC | 37.382802 | Declination of IFU center |



### HDU1: INDIVIDUAL_EXPOSURE_REDUCTION
This extension contains fiber position, spectroscopic redshift, spectra data, SILO foreground model, 			residuals, and SN for each RSS with sufficent SN to model

#### HDU Type: BINARY TABLE
#### HDU Size:  48 MB

##### Header Table Caption for HDU1
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | BINTABLE | binary table extension |
| BITPIX | 8 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 129 | length of dimension 1 |
| NAXIS2 | 252 | length of dimension 2 |
| PCOUNT | 50594544 | number of group parameters |
| GCOUNT | 1 | number of groups |
| TFIELDS | 22 | number of table fields |
| TUNIT7 | Arcseconds |  |
| TUNIT8 | Arcseconds |  |
| TUNIT9 | Arcseconds |  |
| TUNIT10 | Arcseconds |  |
| TUNIT11 | Redshift |  |
| TUNIT12 | 10^-17 erg/s/cm^2/Ang |  |
| TUNIT15 | Arcseconds |  |
| TUNIT16 | Arcseconds |  |
| TUNIT17 | Arcseconds |  |
| TUNIT18 | 10^-17 erg/s/cm^2/Ang |  |
| TUNIT19 | 10^-17 erg/s/cm^2/Ang |  |
| EXTNAME | INDIVIDUAL_EXPOSURE_REDUCTION | extension name |

##### Binary Table Caption for HDU1
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | RSS_INDEX | int32 |  | Row-stacked spectra index |
 | DITHER_POSITION | char[1] |  | Fiber position in dither pattern |
 | FIBER_INDEX | int32 |  | Fiber index within IFU |
 | FIBER_POSITION | char[4] |  | Fiber number in IFU and dither position |
 | EXPNUM | int32 |  | Exposure number |
 | SET | int32 |  | Iteration of dither pattern set |
 | SEEING | float32 | Arcseconds | Seeing at time of exposure |
 | MEAN_X | float32 | Arcseconds | Mean x position of fiber |
 | MEAN_Y | float32 | Arcseconds | Mean y position of fiber |
 | MEAN_R | float32 | Arcseconds | Mean radius position of fiber |
 | SPECZ | float32 | Redshift | Best fit redshfit of spectra in fiber |
 | FLUX | float32[PE(4563] | 10^-17 erg/s/cm^2/Ang | Flux of spectra |
 | IVAR | float32[PE(4563] |  | Inverse variance of spectra |
 | MASK | int32[PJ(4563] |  | Bit mask of spectra |
 | XPOS | float32[PE(4563] | Arcseconds | X position of wavelenth-dependent spectra |
 | YPOS | float32[PE(4563] | Arcseconds | Y position of wavelenth-dependent spectra |
 | RPOS | float32[PE(4563] | Arcseconds | Radius of wavelenth-dependent spectra |
 | MODEL | float32[PE(4563] | 10^-17 erg/s/cm^2/Ang | SILO model of flux |
 | RESFLUX | float32[PE(4563] | 10^-17 erg/s/cm^2/Ang | Residual spectra of flux-model |
 | IVAR_RES | float32[PE(4563] |  | Rescaled inverse variance of residual spectra |
 | SN_SPEC | float32[PE(4563] |  | Gaussian convolved SN of residual spectra |
 | O2SN_SPEC | float32[PE(4563] |  | OII Gaussian convolved SN of residual spectra |



### HDU2: STACKED_REDUCTION
This extension contains stack fibers information, stacked spectroscopic redshift, stacked residuals, masks returned from co-addition, and SN for each stack.

#### HDU Type: BINARY TABLE
#### HDU Size:  13 MB

##### Header Table Caption for HDU2
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | BINTABLE | binary table extension |
| BITPIX | 8 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 128 | length of dimension 1 |
| NAXIS2 | 84 | length of dimension 2 |
| PCOUNT | 13802544 | number of group parameters |
| GCOUNT | 1 | number of groups |
| TFIELDS | 19 | number of table fields |
| TUNIT5 | Arcseconds |  |
| TUNIT6 | Arcseconds |  |
| TUNIT7 | Arcseconds |  |
| TUNIT8 | Arcseconds |  |
| TUNIT9 | Radians |  |
| TUNIT10 | Redshift |  |
| TUNIT11 | Arcseconds |  |
| TUNIT12 | Arcseconds |  |
| TUNIT13 | Arcseconds |  |
| TUNIT16 | 10^-17 erg/s/cm^2/Ang |  |
| EXTNAME | STACKED_REDUCTION | extension name |

##### Binary Table Caption for HDU2
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | FIBER_POSITION | char[4] |  | Fiber number and dither position |
 | RSS_INDX | int32[PJ(3] |  | Row-stacked index(s) of spectra in stack |
 | EXPNUM | int32[PJ(3] |  | Stacked exposure numbers |
 | SET | int32[PJ(3] |  | Stacked dither pattern iterations |
 | SEEING | float32[PE(3] | Arcseconds | Seeing of stacked RSS |
 | MEAN_X | float32 | Arcseconds | Stacked RSS mean x position |
 | MEAN_Y | float32 | Arcseconds | Stacked RSS mean y position |
 | MEAN_R | float32 | Arcseconds | Stacked RSS mean r position |
 | MEAN_THETA | float32 | Radians | Stacked RSS mean angle from East |
 | MEAN_SPECZ | float32 | Redshift | Mean redshift of stacked RSS |
 | MEAN_XPOS | float32[PE(4563] | Arcseconds | Stacked mean wavelength-dependent x position |
 | MEAN_YPOS | float32[PE(4563] | Arcseconds | Stacked mean wavelength-dependent y position |
 | MEAN_RPOS | float32[PE(4563] | Arcseconds | Stacked mean wavelength-dependent radius |
 | AND_MASK | int32[PJ(4563] |  | Andmask of stacked spectra |
 | OR_MASK | int32[PJ(4563] |  | Ormask of stacked spectra |
 | SRESFLUX | float32[PE(4563] | 10^-17 erg/s/cm^2/Ang | Stacked residual spectra of flux-model |
 | SIVAR | float32[PE(4563] |  | Stacked rescaled inverse variance |
 | SSN_SPEC | float32[PE(4563] |  | Gauss convolved SN of stack |
 | SO2SN_SPEC | float32[PE(4563] |  | OII Gauss convolved SN of stack |



### HDU3: WAVE
Wavelength vector.

#### HDU Type: IMAGE
#### HDU Size:  35 KB

##### Header Table Caption for HDU3
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | WAVE | extension name |



### HDU4: SPECRES
Median spectral resolution as a function of wavelength for the fibers in this IFU.

#### HDU Type: IMAGE
#### HDU Size:  35 KB

##### Header Table Caption for HDU4
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | SPECRES | extension name |



### HDU5: SPECRESD
Standard deviation of spectral resolution as a function of wavelength for the fibers in this IFU.

#### HDU Type: IMAGE
#### HDU Size:  35 KB

##### Header Table Caption for HDU5
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | SPECRESD | extension name |



### HDU6: PRESPECRES
Median pre-pixel spectral resolution as a function of wavelength for the fibers in this IFU

#### HDU Type: IMAGE
#### HDU Size:  35 KB

##### Header Table Caption for HDU6
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | PRESPECRES | extension name |



### HDU7: PRESPECRESD
Standard deviation of pre-pixel spectral resolution as a function of wavelength for the fibers in this IFU

#### HDU Type: IMAGE
#### HDU Size:  35 KB

##### Header Table Caption for HDU7
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | PRESPECRESD | extension name |



### HDU8: CUBE_INDIVIDUAL_FLUX
Spaxel CUBE construction of RSS FLUX

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU8
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_FLUX | extension name |



### HDU9: CUBE_INDIVIDUAL_MODEL
Spaxel CUBE construction of SILO model fitted to RSS FLUX

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU9
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_MODEL | extension name |



### HDU10: CUBE_INDIVIDUAL_RESIDUALS
Spaxel CUBE construction of residuals from RSS-model

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU10
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_RESIDUALS | extension name |



### HDU11: CUBE_INDIVIDUAL_IVAR_RESCALED
Spaxel CUBE construction of inverse-variance

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU11
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_IVAR_RESCALED | extension name |



### HDU12: CUBE_INDIVIDUAL_GAUSS_SN
Spaxel CUBE construction of SN computed using Gaussian kernel representing single emission-line

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU12
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_GAUSS_SN | extension name |



### HDU13: CUBE_INDIVIDUAL_GAUSS_O2SN
Spaxel CUBE construction of SN computed using Gaussian kernel representing OII(b, a) doublet

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU13
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_INDIVIDUAL_GAUSS_O2SN | extension name |



### HDU14: CUBE_STACKED_RESIDUALS
Spaxel CUBE construction of stacked residuals

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU14
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_STACKED_RESIDUALS | extension name |



### HDU15: CUBE_IVAR_RESCALED_STACKED
Spaxel CUBE construction of inverse variance of residuals

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU15
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_IVAR_RESCALED_STACKED | extension name |



### HDU16: CUBE_STACKED_GAUSS_SN
Spaxel CUBE construction of stacked SN computed using Gaussian kernel representing single emission-line

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU16
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_STACKED_GAUSS_SN | extension name |



### HDU17: CUBE_STACKED_GAUSS_O2SN
Spaxel CUBE construction of stacked SN computed using Gaussian kernel representing OII(b, a) doublet

#### HDU Type: IMAGE
#### HDU Size:  94 MB

##### Header Table Caption for HDU17
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image extension |
| BITPIX | -64 | array data type |
| NAXIS | 3 | number of array dimensions |
| NAXIS1 | 52 |  |
| NAXIS2 | 52 |  |
| NAXIS3 | 4563 |  |
| PCOUNT | 0 | number of parameters |
| GCOUNT | 1 | number of groups |
| EXTNAME | CUBE_STACKED_GAUSS_O2SN | extension name |



---
## Notes

Examples
How to access the file for a specific target, plot flux, and create a SN narrowband image

from astropy.io import fits
import numpy as np
from matplotlib import pyplot as plt
		
#Lets open the the file to Plate: 8606, IFU: 6102
hdu = fits.open('manga_8606_6102_stack_data.fits')
        
#And look at the extensions
hdu.info()
        
#If you followed the example from silo_manga_detections.html, you would have looked at a detection with this info
fiber_position = '18N'
wavelength_of_candidate_OII = 6674.212
        
#Lets plot the stacked residuals used to create the candidate emission-line cutout from the example from silo_manga_detections.html
stack_index = hdu['STACKED_REDUCTION'].data['FIBER_POSITION'] == fiber_position
plt.plot(hdu['WAVE'].data, hdu['STACKED_REDUCTION'].data['SRESFLUX'][stack_index][0], 'r')
plt.xlabel('Observed Wavelength (Angstroms)')
plt.ylabel('Flux (10^-17 ergs/s/cm^2/Ang)')
plt.show()
		
#This stack is rather boaring with the foreground galaxy flux removed. 
#However, you can observe the candidate OII(b,a) at 6674.212 Ansgstroms!!
#Mabey the SN narrowband will be a bit more interesting
wave_index = np.abs(hdu['WAVE'].data-wavelength_of_candidate_OII).argmin()
plt.imshow(hdu['CUBE_STACKED_GAUSS_O2SN'].data[wave_index, :, :])
plt.title('OII SN Narrowband at Wavelength of Candidate OII')
plt.show()
		
#Either there are two or three background galaxies, or there is one galaxy at the outskirts of the IFU (which is visble in SDSS images)
#and the 'donught' at the center may be a main and counter image. The 'donught' was examined by Smith et al. 2020 via Subaru FOCAS IFU, 
#which observations assures a main and counter image but a second background galaxy is likely present near the counter image. 
#Such features may not be easily confirmed in other targets since it is likely that the SN of the extended source features are 
#relatively faint to the center of the source.
    