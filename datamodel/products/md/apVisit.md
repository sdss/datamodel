# Data Model: apVisit


APOGEE Redux combined visit file


## Contents
- [Basic Information](#basic-information)
- [Changelog](#changelog)
- [Example HDUS List](#example-hdus-list)
- [Notes](#notes)
- [Regrets](#regrets)
---

## Basic Information
apVisit files have data from a visit for each star, along with an initial RV measurement; this is the level where files are split by fiber with an associated format change: the three chips are now included as separate rows in each HDU (since these contain data only from a single fiber). Native wavelength sampling is still preserved; wavelength solution coefficients are now moved to individual headers.

### Naming Convention
<code>apVisit-[0-9]{4}-[0-9]{5}-[0-9]{3}\.fits</code>, where <code>[0-9]{4}</code> is the 4-digit plate number, <code>[0-9]{5}</code> is the 5-digit MJD number and <code>[0-9]{3}</code> is the zero-padded, 3-digit fiber number.

### Releases
DR16, DR17, DR19

### Enviroments
APOGEE_REDUX

### Approximate Size
483 KB

### File Type
FITS

### Generated by Product
apogeereduce (apvisit_output)

### Is a VAC
False

### HDUS List for release DR19
  - [HDU0: PRIMARY](#hdu0-primary)
  - [HDU1: FLUX](#hdu1-flux)
  - [HDU2: ERROR](#hdu2-error)
  - [HDU3: MASK](#hdu3-mask)
  - [HDU4: WAVELENGTH](#hdu4-wavelength)
  - [HDU5: SKY FLUX](#hdu5-sky flux)
  - [HDU6: SKY ERROR](#hdu6-sky error)
  - [HDU7: TELLURIC](#hdu7-telluric)
  - [HDU8: TELLURIC ERROR](#hdu8-telluric error)
  - [HDU9: WAVE COEFFICIENTS](#hdu9-wave coefficients)
  - [HDU10: LSF COEFFICIENTS](#hdu10-lsf coefficients)
  - [HDU11](#hdu11)

---

## Changelog
Describes changes to the datamodel product and/or file structure from one release to another
 - DR19
   - from: DR17
   - added_hdus: ['ERROR', 'TELLURIC', 'LSF COEFFICIENTS', 'WAVELENGTH', 'FLUX', 'SKY ERROR', 'TELLURIC ERROR', 'WAVE COEFFICIENTS', 'MASK', 'SKY FLUX']
   - primary_delta_nkeys: 17
   - added_primary_header_kwargs: ['HMAG', 'CADENCE', 'GRELEASE', 'ONTARGET', 'VALID', 'SVTARG0', 'PROGRAM', 'GGMAG', 'TARG4', 'ASSIGNED', 'GBPMAG', 'GPMDEC', 'KMAG', 'APRED', 'CATID', 'SVAPTRG0', 'CARTON1', 'GRPMAG', 'GPMRA', 'JMAG', 'GPLX', 'CATEGORY']
   - removed_primary_header_kwargs: ['WAVEID', 'HISTORY', 'RELFLUX', 'FRAME8', 'FRAME4', 'FRAME2', 'CARTID', 'FRAME3', 'LSFID', 'K', 'COMMENT', 'AKTARG', 'FRAME5', 'J', 'FRAME7', 'SFD_EBV', 'H', 'AKWISE', 'FRAME6', 'MTPFLUX', 'AKMETHOD']
 - DR17
   - from: DR16
   - primary_delta_nkeys: 23
   - added_primary_header_kwargs: ['WAVEID', 'CARTID', 'RELFLUX', 'MTPFLUX', 'LSFID']
   - removed_primary_header_kwargs: ['RVLOGG', 'RVTEFF', 'VGSR', 'RVALPH', 'GLAT', 'LONGSTRN', 'SYNTHFIL', 'CHISQ', 'GLON', 'HJD', 'CCPFWHM', 'VLSR', 'RVFEH', 'VSCATTER', 'XSHIFT', 'VHELIO', 'CCPEAK', 'BC', 'VRADERR', 'RVCARB', 'JD', 'VTYPE', 'VRAD']

---
## Example HDUS List

### HDU0: PRIMARY


#### HDU Type: IMAGE
#### HDU Size:  0 bytes

##### Header Table Caption for HDU0
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True |  |
| BITPIX | 16 |  |
| NAXIS | 0 |  |
| EXTEND | True |  |
| DATE | 2022-10-15 | Creation UTC (CCCC-MM-DD) date of FITS header |
| LOCID | 100537 | Location ID of field |
| PLATE | 4895 | Plate ID |
| TELESCOP | apo25m | Telescope |
| MJD5 | 59683 | MJD of observation |
| FIBERID | 101 | APOGEE Fiber ID 1-300 |
| DATE-OBS | 2022-04-14T09:14:54.226 | Observation timestamp |
| EXPTIME | 457.921 | Exposure time |
| JD-MID | 2459683.888 | JD at midpoint of visit |
| UT-MID | 2022-04-14T09:18:43.2 | Date at midpoint of visit |
| NCOMBINE | 1 | Number of exposures combined |
| FRAME1 | 0 | Constituent frame |
| NPAIRS | 0 | Number of dither pairs combined |
| OBJID | 2M18312966+0037563 | Object ID |
| OBJTYPE | STAR | Object type |
| RA | 277.873526423 | targeting right ascension, deg, J2000 |
| DEC | 0.632144693711 | targeting declination, deg, J2000 |
| JMAG | 10.792 | 2MASS J magnitude |
| HMAG | 10.267 | 2MASS H magnitude |
| KMAG | 9.988 | 2MASS Ks magnitude |
| SNR | 65.0601 | median S/N, middle chip |
| SURVEY | SDSS-V | Survey definition (for targeting flags) |
| TARG1 | 0 | First APOGEE targeting flag (bitwise, see docs) |
| TARG2 | 0 | Second APOGEE targeting flag (bitwise, see docs |
| TARG3 | 0 | Third APOGEE targeting flag (bitwise, see docs) |
| TARG4 | 0 | Fourth APOGEE targeting flag (bitwise, see docs |
| SVAPTRG0 | 0 | SDSS-V APOGEE target0 |
| CATID | 27021598755520772 | SDSS-V catalogID |
| GRELEASE | dr3 | Gaia data release |
| GPLX | 2.07651 | Gaia parallax |
| GPMRA | -10.7297 | Gaia pmra |
| GPMDEC | -23.8428 | Gaia pmdec |
| GGMAG | 13.4712 | Gaia G magnitude |
| GBPMAG | 14.5613 | Gaia Bp magnitude |
| GRPMAG | 12.4309 | Gaia Rp magnitude |
| HPLUS | 2.162 | Delta H (neigh-obj) mag of neighboring (+1) fib |
| HMINUS | 2.027 | Delta H (neigh-obj) mag of neighboring (-1) fib |
| ASSIGNED | 1 | FPS target assigned |
| ONTARGET | 1 | FPS fiber on target |
| VALID | 1 | Valid FPS target |
| SVTARG0 | 0 | SDSS-V APG targeting bitmask |
| CARTON1 | mwm_yso_pms_apogee | SDSS-V firstcarton |
| CADENCE | bright_3x1 | SDSS-V target cadence |
| PROGRAM | mwm_yso | SDSS-V target program |
| CATEGORY | science | SDSS-V target category |
| STARFLAG | 0 | Star data quality flag |
| FLUXFLAM | 1.82139e-18 | ADU to flux units conv factor (ergs/s/cm^2/A) |
| V_APRED | 69de0d7427363363aae2017a0890751f40a3463e | apogee software version |
| APRED | 1.0 | apogee reduction version |



### HDU1: FLUX
Flux spectrum

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU1
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Flux (10^-17 erg/s/cm^2/Ang) |  |



### HDU2: ERROR
Uncertainty in flux

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU2
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Flux Error (10^-17 erg/s/cm^2/Ang) |  |



### HDU3: MASK
Mask

#### HDU Type: IMAGE
#### HDU Size:  24 KB

##### Header Table Caption for HDU3
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | 16 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Flag Mask (bitwise) |  |



### HDU4: WAVELENGTH
Wavelength array

#### HDU Type: IMAGE
#### HDU Size:  96 KB

##### Header Table Caption for HDU4
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -64 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Wavelength (Ang) |  |



### HDU5: SKY FLUX
Sky emission spectrum

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU5
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Sky (10^-17 erg/s/cm^2/Ang) |  |



### HDU6: SKY ERROR
Uncertainty in the sky spectrum

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU6
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Sky Error (10^-17 erg/s/cm^2/Ang) |  |



### HDU7: TELLURIC
Telluric absorption spectrum

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU7
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Telluric |  |



### HDU8: TELLURIC ERROR
Uncertainty in the telluric spectrum

#### HDU Type: IMAGE
#### HDU Size:  48 KB

##### Header Table Caption for HDU8
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE |  |
| BITPIX | -32 |  |
| NAXIS | 2 |  |
| NAXIS1 | 4096 |  |
| NAXIS2 | 3 |  |
| PCOUNT | 0 |  |
| GCOUNT | 1 |  |
| CTYPE1 | Pixel |  |
| CTYPE2 | Chip |  |
| BUNIT | Telluric Error |  |



### HDU9: WAVE COEFFICIENTS
Wavelength coefficients

#### HDU Type: IMAGE
#### HDU Size:  336 bytes

##### Header Table Caption for HDU9
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | in addition to the pixel offset) |
| BITPIX | -64 | in addition to the pixel offset) |
| NAXIS | 2 | in addition to the pixel offset) |
| NAXIS1 | 14 | in addition to the pixel offset) |
| NAXIS2 | 3 | in addition to the pixel offset) |
| PCOUNT | 0 | in addition to the pixel offset) |
| GCOUNT | 1 | in addition to the pixel offset) |
| CTYPE1 | Fiber | in addition to the pixel offset) |
| CTYPE2 | Parameters | in addition to the pixel offset) |
| BUNIT | Wavelength Coefficients | in addition to the pixel offset) |
| HISTORY | Wavelength Coefficients to be used with PIX2WAVE.PRO: | in addition to the pixel offset) |
| HISTORY |  1 Global additive pixel offset | in addition to the pixel offset) |
| HISTORY |  4 Sine Parameters | in addition to the pixel offset) |
| HISTORY |  7 Polynomial parameters (first is a zero-point offset | in addition to the pixel offset) |
| HISTORY |                      in addition to the pixel offset) | in addition to the pixel offset) |



### HDU10: LSF COEFFICIENTS
LSF coefficients

#### HDU Type: IMAGE
#### HDU Size:  624 bytes

##### Header Table Caption for HDU10
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | start with H1 since we fix H0=1. |
| BITPIX | -64 | start with H1 since we fix H0=1. |
| NAXIS | 2 | start with H1 since we fix H0=1. |
| NAXIS1 | 26 | start with H1 since we fix H0=1. |
| NAXIS2 | 3 | start with H1 since we fix H0=1. |
| PCOUNT | 0 | start with H1 since we fix H0=1. |
| GCOUNT | 1 | start with H1 since we fix H0=1. |
| CTYPE1 | Fiber | start with H1 since we fix H0=1. |
| CTYPE2 | Parameters | start with H1 since we fix H0=1. |
| BUNIT | LSF Coefficients | start with H1 since we fix H0=1. |
| HISTORY | LSF Coefficients to be used with LSF_GH.PRO: | start with H1 since we fix H0=1. |
| HISTORY |   binsize  The width of a pixel in X-units.  If this is non-zero | start with H1 since we fix H0=1. |
| HISTORY |              then a "binned" Gauss-Hermite function is used.  If | start with H1 since we fix H0=1. |
| HISTORY |              binsize=0 then a "normal, unbinned" Gauss-Hermite | start with H1 since we fix H0=1. |
| HISTORY |              function is used. | start with H1 since we fix H0=1. |
| HISTORY |   X0       An additive x-offset.  This is only used to | start with H1 since we fix H0=1. |
| HISTORY |              evaluate the GH parameters that vary globally | start with H1 since we fix H0=1. |
| HISTORY |              with X. | start with H1 since we fix H0=1. |
| HISTORY |   Horder   The highest Hermite order, Horder=0 means | start with H1 since we fix H0=1. |
| HISTORY |              only a constant term (i.e. only Gaussian). | start with H1 since we fix H0=1. |
| HISTORY |              There are Horder Hermite coefficients (since we fix H0=1). | start with H1 since we fix H0=1. |
| HISTORY |   Porder   This array gives the polynomial order for the | start with H1 since we fix H0=1. |
| HISTORY |              global variation (in X) of each LSF parameter. | start with H1 since we fix H0=1. |
| HISTORY |              That includes sigma and the Horder Hermite | start with H1 since we fix H0=1. |
| HISTORY |              coefficients (starting with H1 because we fix H0=1) | start with H1 since we fix H0=1. |
| HISTORY |              There will be Porder[i]+1 coefficients for | start with H1 since we fix H0=1. |
| HISTORY |              parameter i. | start with H1 since we fix H0=1. |
| HISTORY |   GHcoefs  The polynomial coefficients for sigma and the | start with H1 since we fix H0=1. |
| HISTORY |              Horder Hermite parameters.  There are Porder[i]+1 | start with H1 since we fix H0=1. |
| HISTORY |              coefficients for parameter i.  The Hermite parameters | start with H1 since we fix H0=1. |
| HISTORY |              start with H1 since we fix H0=1. | start with H1 since we fix H0=1. |



### HDU11: 
Summary table

#### HDU Type: BINARY TABLE
#### HDU Size:  471 bytes

##### Header Table Caption for HDU11
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | BINTABLE | Binary table written by MWRFITS v1.13 |
| BITPIX | 8 | Required value |
| NAXIS | 2 | Required value |
| NAXIS1 | 471 | Number of bytes per row |
| NAXIS2 | 1 | Number of rows |
| PCOUNT | 0 | Normally 0 (no varying arrays) |
| GCOUNT | 1 | Required value |
| TFIELDS | 61 | Number of columns in table |
| COMMENT |  |  |
| COMMENT |  *** End of mandatory fields *** |  |
| COMMENT |  |  |
| COMMENT |  |  |
| COMMENT |  *** Column formats *** |  |
| COMMENT |  |  |
| COMMENT |  |  |
| COMMENT |  *** Column names *** |  |
| COMMENT |  |  |

##### Binary Table Caption for HDU11
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | APOGEE_ID | char[18] |  | 2MASS-style star identification |
 | TARGET_ID | char[18] |  | Unique ID for visit spectrum, of form apogee.[telescope].[cs].[apred_version].plate.mjd.fiberid (Primary key) |
 | FILE | char[38] |  | File base name with visit spectrum and catalog information |
 | URI | char[94] |  | Resource identifier for the full path of the combined apVisit spectrum file |
 | APRED_VERS | char[3] |  | APOGEE reduction version |
 | FIBERID | int16 |  | Fiber ID for this visit |
 | PLATE | char[4] |  | Plate (for plate era) or configurationID (for FPS era) of this visit |
 | EXPTIME | float32 | sec | Total exposure time |
 | NFRAMES | int32 |  | Number of exposures in the visit |
 | MJD | int32 | days | Modified Julian Date of the night |
 | TELESCOPE | char[6] |  | Telescope where data was taken |
 | SURVEY | char[6] |  | SDSS-V survey |
 | FIELD | char[6] |  | SDSS-V field ID |
 | DESIGN | char[6] |  | SDSS-V design ID |
 | PROGRAMNAME | char[17] |  | SDSS-V program name |
 | OBJTYPE | char[4] |  | Object type |
 | ASSIGNED | int16 |  | FPS target assigned |
 | ON_TARGET | int16 |  | FPS fiber on target |
 | VALID | int16 |  | Valid FPS target |
 | RA | float64 | degree | Right ascension, J2000 |
 | DEC | float64 | degree | Declination, J2000 |
 | GLON | float64 | degree | Galactic longitude |
 | GLAT | float64 | degree | Galactic latitude |
 | HEALPIX | int64 |  | HEALPix number for this star, nside=128 |
 | JMAG | float32 | mag | 2MASS J magnitude |
 | JERR | float32 | mag | 2MASS J magnitude uncertainty |
 | HMAG | float32 | mag | 2MASS H magnitude |
 | HERR | float32 | mag | 2MASS H magnitude uncertainty |
 | KMAG | float32 | mag | 2MASS Ks magnitude |
 | KERR | float32 | mag | 2MASS Ks magnitude uncertainty |
 | SRC_H | char |  | H magnitude used |
 | PMRA | float32 | mas/yr | Proper motion in right ascension used in target selection |
 | PMDEC | float32 | mas/yr | Proper motion in declination used in target selection |
 | PM_SRC | char |  | Source of proper motion used in target selection |
 | APOGEE_TARGET1 | int32 |  | APOGEE-2 target flag (first 64 bits) (see https://www.sdss4.org/dr17/algorithms/bitmasks/#APOGEE2_TARGET1) |
 | APOGEE_TARGET2 | int32 |  | APOGEE-2 target flag (second 64 bits) (see https://www.sdss4.org/dr17/algorithms/bitmasks/#APOGEE2_TARGET2) |
 | APOGEE_TARGET3 | int32 |  | APOGEE-2 target flag (third 64 bits) (see https://www.sdss4.org/dr17/algorithms/bitmasks/#APOGEE2_TARGET3) |
 | APOGEE_TARGET4 | int32 |  | APOGEE-2 target flag (fourth 64 bits) (see https://www.sdss4.org/dr17/algorithms/bitmasks/#APOGEE2_TARGET3) |
 | SDSS5_TARGET_PKS | char[29] |  | SDSS-V target_pks (comma-delimited list) |
 | SDSS5_TARGET_CATALOGIDS | char[46] |  | SDSS-V catalogIDs (comma-delimited list) |
 | SDSS5_TARGET_CARTON_PKS | char[72] |  | SDSS-V carton_pks (comma-delimited list) |
 | SDSS5_TARGET_CARTONS | char[195] |  | SDSS-V carton names (comma-delimited list) |
 | SDSS5_TARGET_FLAGSHEX | char[112] |  | SDSS-V carton flags as hexadecimal string |
 | BRIGHTNEICOUNT | int32 |  | Count of bright neighbors |
 | BRIGHTNEIFLAG | int32 |  | Bright neighbor flag |
 | BRIGHTNEIFLUXFRAC | float32 |  | Bright neighbor flux fraction |
 | CATALOGID | int64 |  | SDSS-V catalog identification number |
 | SDSS_ID | int64 |  | SDSS-V sdss_id identification number |
 | RA_SDSS_ID | float64 |  | Right Ascension of unique SDSS-V sdss_id object |
 | DEC_SDSS_ID | float64 |  | Declination of unique SDSS-V sdsss_id object |
 | GAIA_RELEASE | int64 |  | GAIA data release used |
 | GAIA_SOURCEID | int64 |  | GAIA source identification |
 | GAIA_PLX | float32 | mas | GAIA parallax |
 | GAIA_PLX_ERROR | float32 | mas | GAIA parallax uncertainty |
 | GAIA_PMRA | float32 | mas/yr | GAIA proper motion in RA |
 | GAIA_PMRA_ERROR | float32 | mas/yr | GAIA proper motion in RA uncertainty |
 | GAIA_PMDEC | float32 | mas/yr | GAIA proper motion in DEC |
 | GAIA_PMDEC_ERROR | float32 | mas/yr | GAIA proper motion in DEC uncertainty |
 | GAIA_GMAG | float32 | mag | GAIA G mean magnitude |
 | GAIA_GERR | float32 | mag | GAIA G mean magnitude uncertainty |
 | GAIA_BPMAG | float32 | mag | GAIA Bp mean magnitude |
 | GAIA_BPERR | float32 | mag | GAIA Bp mean magnitude uncertainty |
 | GAIA_RPMAG | float32 | mag | GAIA Rp mean magnitude |
 | GAIA_RPERR | float32 | mag | GAIA Rp mean magnitude uncertainty |
 | SDSSV_APOGEE_TARGET0 | int64 |  | SDSS-V early targeting flag |
 | FIRSTCARTON | char[18] |  | SDSS-V primary target carton |
 | CADENCE | char[10] |  | SDSS-V cadence type |
 | PROGRAM | char[7] |  | SDSS-V program name |
 | CATEGORY | char[7] |  | SDSS-V category |
 | TARGFLAGS | char |  | Targeting flags |
 | SNR | float32 |  | Median signal-to-noise ratio per pixel |
 | STARFLAG | int32 |  | Star-level quality flags as integer |
 | STARFLAGS | char |  | Star-level quality flags as comma-delimited ASCII text |
 | DATEOBS | char[23] |  | Date of observation (YYYY-MM-DDTHH:MM:SS.SSS) |
 | JD | float64 | days | Julian date of observation |



---
## Notes
None

---
## Regrets
I have no regrets!