# Data Model: spFlat


migration: needs update


## Contents
- [Basic Information](#basic-information)
- [Changelog](#changelog)
- [Example HDU List](#example-hdu-list)


---

## Basic Information
This file contains information about fiberflats, X-centers of fibers, fibermask, profile width and superflat obtained from extracted flat calibration frames. This file is generated
as a product of spcalib.pro.

### Naming Convention
Filenames have the form spFlat-[c][n]-mmmmmmmm.fits.gz, where c indicates either a blue or red spectrograph, n indicates the spectrograph number (1 or 2) and mmmmmmmm indicates the frame number. An example of filename is spFlat-r2-00111703.fits.gz.

### Releases
DR9, DR10, DR12, DR11, DR13, DR14, DR15, DR16, DR17

### Enviroments
BOSS_SPECTRO_REDUX

### Approximate Size
4 MB

### File Type
FITS

### Generated by Product
spCalib.pro

### HDU List for release DR17
  - [HDU0: PRIMARY](#hdu0-primary)
  - [HDU1: ](#hdu1-)
  - [HDU2: ](#hdu2-)
  - [HDU3: ](#hdu3-)
  - [HDU4: ](#hdu4-)


---

## Changelog
Describes changes to the datamodel product and/or file structure from one release to another
 - DR17
   - from: DR16
   - note: No changes
 - DR16
   - from: DR15
   - note: No changes
 - DR15
   - from: DR14
   - note: No changes
 - DR14
   - from: DR13
   - note: No changes
 - DR13
   - from: DR11
   - note: No changes
 - DR11
   - from: DR12
   - note: No changes
 - DR12
   - from: DR10
   - note: No changes
 - DR10
   - from: DR9
   - note: No changes

---
## Example HDU List


### HDU0: PRIMARY
The primary HDU data is an array of flat-field vectors for each fiber that removes relative flat-field variations as a function of wavelength between fibers. These are referred as fiberflats.
<b>
Required header keywords:
</b>
<b>
Optional header keywords:
</b>

#### HDU Type: IMAGE
#### HDU Size:  7 MB

##### Header Table Caption for HDU0
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True | conforms to FITS standard |
| BITPIX | -32 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 4112 | length of dimension 1 |
| NAXIS2 | 500 | length of dimension 2 |
| EXTEND | True |  |
| TELESCOP | SDSS 2.5-M | Sloan Digital Sky Survey |
| FILENAME | sdR-b1-00108605.fit | migration: description of keyword/column not found. Needs update |
| CAMERAS | b1 | migration: description of keyword/column not found. Needs update |
| EXPOSURE | 108605 | migration: description of keyword/column not found. Needs update |
| DAQVER | 1.2.8 | migration: description of keyword/column not found. Needs update |
| CAMDAQ | 1.4.1:32 | migration: description of keyword/column not found. Needs update |
| ERRCNT | NONE | migration: description of keyword/column not found. Needs update |
| SYNCERR | NONE | migration: description of keyword/column not found. Needs update |
| SLINES | NONE | migration: description of keyword/column not found. Needs update |
| PIXERR | NONE | migration: description of keyword/column not found. Needs update |
| PLINES | NONE | migration: description of keyword/column not found. Needs update |
| FLAVOR | flat | exposure type, SDSS spectro style |
| BOSSVER | v2_0_17 | ICC version |
| MJD | 55244 | APO fMJD day at start of exposure |
| TAI-BEG | 4773100101.0 | MJD(TAI) seconds at start of integration |
| DATE-OBS | 2010-02-17T05:08:21 | TAI date at start of integration |
| FF | 1 1 1 1 | FF lamps 1:on 0:0ff |
| NE | 0 0 0 0 | NE lamps 1:on 0:0ff |
| HGCD | 0 0 0 0 | HGCD lamps 1:on 0:0ff |
| FFS | 1 1 1 1 1 1 1 1 | Flatfield Screen 1:closed 0:open |
| OBJSYS | ICRS | The TCC objSys |
| RA | 120.0777 | RA of telescope boresight (deg) |
| DEC | 53.2734 | Dec of telescope boresight (deg) |
| RADEG | 120.0777 | RA of telescope pointing(deg) |
| DECDEG | 53.2734 | Dec of telescope pointing (deg) |
| ROTPOS | 0.0 | Rotator request position (deg) |
| BOREOFFX | 0.0 | TCC Boresight offset, deg |
| BOREOFFY | 0.0 | TCC Boresight offset, deg |
| ARCOFFX | 0.0 | TCC ObjArcOff, deg |
| ARCOFFY | 0.0 | TCC ObjArcOff, deg |
| OBJOFFX | 0.0 | TCC ObjOff, deg |
| OBJOFFY | 0.0 | TCC ObjOff, deg |
| CALOFFX | 0.002 | TCC CalibOff, deg |
| CALOFFY | -0.001 | TCC CalibOff, deg |
| CALOFFR | 0.0 | TCC CalibOff, deg |
| GUIDOFFX | 0.0 | TCC GuideOff, deg |
| GUIDOFFY | 0.0 | TCC GuideOff, deg |
| GUIDOFFR | 0.0 | TCC GuideOff, deg |
| AZ | 176.583 | Azimuth axis pos. (approx, deg) |
| ALT | 69.493 | Altitude axis pos. (approx, deg) |
| IPA | -4.712 | Rotator axis pos. (approx, deg) |
| SPA | 175.4260075864258 | TCC SpiderInstAng |
| FOCUS | 518.08 | User-specified focus offset (um) |
| M2PISTON | 1895.43 | TCC SecOrient |
| M2XTILT | -3.95 | TCC SecOrient |
| M2YTILT | -9.0 | TCC SecOrient |
| M2XTRAN | 9.91 | TCC SecOrient |
| M2YTRAN | -14.39 | TCC SecOrient |
| M1PISTON | 296.25 | TCC PrimOrient |
| M1XTILT | -3.04 | TCC PrimOrient |
| M1YTILT | 5.26 | TCC PrimOrient |
| M1XTRAN | 277.64 | TCC PrimOrient |
| M1YTRAN | 178.07 | TCC PrimOrient |
| SCALE | 0.99997 | User-specified scale factor |
| NAME | 3682-55244-01 | The name of the currently loaded plate |
| PLATEID | 3682 | The currently loaded plate |
| CARTID | 12 | The currently loaded cartridge |
| MAPID | 1 | The mapping version of the loaded plate |
| POINTING | A | The currently specified pointing |
| GUIDER1 | proc-gimg-0422.fits | The first guider image |
| COLLA | -8460 | The position of the A collimator motor |
| COLLB | -8486 | The position of the B collimator motor |
| COLLC | -8505 | The position of the C collimator motor |
| HARTMANN | Out | Hartmanns: Left,Right,Out |
| MC1HUMHT | 39.1 | sp1 mech Hartmann humidity, % |
| MC1HUMCO | 34.0 | sp1 mech Central optics humidity, % |
| MC1TEMDN | -1.1 | sp1 mech Median temp, C |
| MC1THT | -1.3 | sp1 mech Hartmann Top Temp, C |
| MC1TRCB | -1.5 | sp1 mech Red Cam Bottom Temp, C |
| MC1TRCT | -0.6 | sp1 mech Red Cam Top Temp, C |
| MC1TBCB | -1.3 | sp1 mech Blue Cam Bottom Temp, C |
| MC1TBCT | -1.1 | sp1 mech Blue Cam Top Temp, C |
| MC2HUMHT | 32.6 | migration: description of keyword/column not found. Needs update |
| MC2HUMCO | 20.3 | migration: description of keyword/column not found. Needs update |
| MC2TEMDN | -2.0 | migration: description of keyword/column not found. Needs update |
| MC2THT | -1.3 | migration: description of keyword/column not found. Needs update |
| MC2TRCB | -1.6 | migration: description of keyword/column not found. Needs update |
| MC2TRCT | -2.0 | migration: description of keyword/column not found. Needs update |
| MC2TBCB | -2.1 | migration: description of keyword/column not found. Needs update |
| MC2TBCT | -1.6 | migration: description of keyword/column not found. Needs update |
| GUIDERN | proc-gimg-0422.fits | The last guider image |
| EXPTIME | 31.0 | measured exposure time, s |
| SHOPETIM | 0.72 | open shutter transit time, s |
| SHCLOTIM | 0.555 | close shutter transit time, s |
| CAMROW | 0 | migration: description of keyword/column not found. Needs update |
| CAMCOL | 1 | migration: description of keyword/column not found. Needs update |
| AUTHOR | Scott Burles & David Schlegel | migration: description of keyword/column not found. Needs update |
| VERSIDL | 7.1.1 | Version of IDL |
| VERSUTIL | v5_5_17 | Version of idlutils |
| VERSREAD | v5_13_2 | Version of idlspec2d for pre-processing raw dat |
| VERSLOG | trunk 26892 | Version of SPECLOG product |
| VERSFLAT | v1_32 | Version of SPECFLAT product |
| TWOPHASE | False | Extra 1/3 row in wavecal at array center? |
| QUALITY | excellent | migration: description of keyword/column not found. Needs update |
| RDNOISE0 | 2.03745 | CCD read noise amp 0 [electrons] |
| RDNOISE1 | 1.96296 | CCD read noise amp 1 [electrons] |
| RDNOISE2 | 1.91541 | CCD read noise amp 2 [electrons] |
| RDNOISE3 | 1.87276 | CCD read noise amp 3 [electrons] |
| PIXFLAT | pixflatave-55056-b1.fits.gz | migration: description of keyword/column not found. Needs update |
| BADPIXEL | badpixels-55056-b1.fits.gz | migration: description of keyword/column not found. Needs update |
| NBRIGHT | 0 | Number of bright pixels (>10^5) in extracted fla |



### HDU1: 
The HDU 1 data is a binary table whose fields are used to calculate the X-centers, for all fibers in the flat-field calibration frames.
The Y-pixel positions on the CCD, which is the independent variable and the corresponding X-centers, which is the dependent variable are fitted to a functional form  and the resulting coefficients are stored in the binary table.
<b>
Required header keywords:
</b>
<b>
Required column names:
</b>

#### HDU Type: BINARY TABLE
#### HDU Size:  27 KB

##### Binary Table Caption for HDU1
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | FUNC | char[8] | migration: unit of keyword/column not found. Needs update | function used to fit the Y-pixel positions on the CCD and corresponding X-centers are fitted to a functional form. |
 | XMIN | float64 | migration: unit of keyword/column not found. Needs update | minimum value of the independent variable used by fitting function. |
 | XMAX | float64 | migration: unit of keyword/column not found. Needs update | maximum value of the independent variable which is used along with the fitting coefficients, in the fitting function to get the value of dependent variable, which is the X-center of fibers. |
 | COEFF | float64[3500] | migration: unit of keyword/column not found. Needs update | [2000](float64)  			:  fit coefficents |



### HDU2: 
The HDU 3 data stores the fibermask. These are fiber status bits and are set to non-zero to indicate bad status. The status bits used for masking are documented in $IDLUTILS/v5_4_12/data/sdss/sdssMaskbits.par.
<b>
Required header keywords:
</b>
<b>
Optional header keywords:
</b>

#### HDU Type: IMAGE
#### HDU Size:  1 KB

##### Header Table Caption for HDU2
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | Image Extension created by MWRFITS v1.8 |
| BITPIX | 32 | array data type |
| NAXIS | 1 | number of array dimensions |
| NAXIS1 | 500 | length of dimension 1 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU3: 
The data attribute of HDU 3 gives the first-order corrected profile width for each fiber bundle. This Gaussian sigma is in units of pixels.
The X-positions on the CCD and their corresponding profile width are fitted to a functional form and the resulting coefficients are stored in a binary table.
The X-position is the independent variable and the width is the dependent variable for the fitting function.
<b>
Required header keywords:
</b>
<b>
Required column names:
</b>

#### HDU Type: BINARY TABLE
#### HDU Size:  11 KB

##### Binary Table Caption for HDU3
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | FUNC | char[8] | migration: unit of keyword/column not found. Needs update | function used to fit the X-positions on CCD and the correspoding profile widths to a functional form. |
 | XMIN | float64 | migration: unit of keyword/column not found. Needs update | minimum value of the independent variable used by fitting function. |
 | XMAX | float64 | migration: unit of keyword/column not found. Needs update | maximum value of the independent variable which is used along with the fitting coefficients, in the fitting function to get the value of dependent variable, which is the profile width of fibers. |
 | COEFF | float64[1500] | migration: unit of keyword/column not found. Needs update | [1500](float64) 			:  fit coefficents |



### HDU4: 
The data attribute of HDU 4 contains superflat which is constructed from extracted flat-field image and is stored in a bspline set structure form.
A superflat is a bspline average across all fibers of the flat spectrum in raw counts as a function of wavelength. The various column name are explained in the b-spline routine in $IDLUTILS/pro/bspline
<b>
Required header keywords:
</b>
<b>
Required column names:
</b>

#### HDU Type: BINARY TABLE
#### HDU Size:  24 KB

##### Binary Table Caption for HDU4
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | FULLBKPT | float32[1815] | migration: unit of keyword/column not found. Needs update | [float] |
 | BKMASK | int16[1815] | migration: unit of keyword/column not found. Needs update | [short int] |
 | NORD | int32 | migration: unit of keyword/column not found. Needs update | [float] |
 | COEFF | float32[1811] | migration: unit of keyword/column not found. Needs update | [1000][float] |
 | ICOEFF | float32[1811] | migration: unit of keyword/column not found. Needs update | [float] |


