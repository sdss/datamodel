# Data Model: proc-gimg


migration: needs update


## Contents
- [Basic Information](#basic-information)
- [Changelog](#changelog)
- [Example HDU List](#example-hdu-list)


---

## Basic Information
<a href="gimg.html">Raw guider images</a> are processed by the guider actor,
which uses the processed results to apply guiding corrections to the telescope,
and to write a proc-gimg file for each raw file showing what went into
calculating those corrections.

### Naming Convention
<code>proc-gimg-[0-9]{4}.fits.gz</code>, where the number is the
frame sequence number, starting from 1 for the first frame of the night (usually
a dark frame).

### Releases
DR12, DR13, DR14, DR15, DR16, DR17

### Enviroments
GCAM_DATA

### Approximate Size
260 KB

### File Type
FITS

### Generated by Product
guiderActor

### HDU List for release DR17
  - [HDU0: PRIMARY](#hdu0-primary)
  - [HDU1: ](#hdu1-)
  - [HDU2: ](#hdu2-)
  - [HDU3: ](#hdu3-)
  - [HDU4: ](#hdu4-)
  - [HDU5: ](#hdu5-)
  - [HDU6: ](#hdu6-)


---

## Changelog
Describes changes to the datamodel product and/or file structure from one release to another
 - DR17
   - from: DR16
   - note: No changes
 - DR16
   - from: DR15
   - note: No changes
 - DR15
   - from: DR14
   - note: No changes
 - DR14
   - from: DR13
   - note: No changes
 - DR13
   - from: DR12
   - note: No changes

---
## Example HDU List


### HDU0: PRIMARY
The primary HDU contains the bias and dark subtracted, flat-fielded image frame
from the gcamera, while the header contains information about the telescope
position, guiding error, and applied offsets. Note that prior to guiderActor
v1_4_0, the bias was only approximate, and flat fields were not applied, and
prior to v1_5_0 dark frames were not applied. The v_guider and v_sop keywords
were introduced in guiderActor v2_5; prior to that, the version of the guider
used to acquire each image was not directly tracked. GAIN, PIXELSC, and READNOIS
were introduced in vXX.

#### HDU Type: IMAGE
#### HDU Size:  512 KB

##### Header Table Caption for HDU0
Key | Value | Comment | |
| --- | --- | --- | --- |
| SIMPLE | True | conforms to FITS standard |
| BITPIX | 16 | data is 16 bit unsigned integer. |
| NAXIS | 2 | 2 dimensional image |
| NAXIS1 | 512 | 1024 pixels + 24 pixel overscan (halved when binned) |
| NAXIS2 | 512 | 1024 pixels (halved when binned) |
| EXTEND | True |  |
| IMAGETYP | object | The image type of the file, e.g. dark, flat, object. |
| EXPTIME | 5.0 | exposure time of single integration |
| TIMESYS | TAI | All systems at APO operate on the TAI time system |
| DATE-OBS | 2010-01-03 00:48:37.3Z | Date and time (in TIMESYS system) that the exposure started. |
| CCDTEMP | -40.07863275000001 | camera temperature in degrees C |
| FILENAME | /data/gcam/55199/gimg-0002.fits | The full path to this image, before gzipping. |
| OBJECT | gimg-0002 | The name of this image, without any extensions. |
| DARKFILE | /data/gcam/55198/gimg-0003.fits | The dark frame associated with this iamge. |
| FLATFILE | /data/gcam/55199/gimg-0001.fits | The flat frame associated with this image. |
| FLATCART | 6 | migration: description of keyword/column is None in database. Needs update |
| BEGX | 0 | migration: description of keyword/column is None in database. Needs update |
| BEGY | 0 | migration: description of keyword/column is None in database. Needs update |
| BINX | 1 | migration: description of keyword/column is None in database. Needs update |
| BINY | 1 | migration: description of keyword/column is None in database. Needs update |
| CRVAL1 | 0 | (output) Column pixel of Reference Pixel |
| CRVAL2 | 0 | (output) Row pixel of Reference Pixel |
| CRPIX1 | 0.5 | Column Pixel Coordinate of Reference |
| CRPIX2 | 0.5 | Row Pixel Coordinate of Reference |
| CTYPE1 | LINEAR | Type of projection |
| CUNIT1 | PIXEL | Column unit |
| CUNIT2 | PIXEL | Row unit |
| SDSSFMT | GPROC 1 2 | guider file version for STUI: v1 has 7 HDUs. |
| IMGBACK | 1821.0 | crude background for entire image. For STUI. |
| SEEING | 0.0 | Estimate of current seeing, arcsec fwhm |
| GCAMSCAL | 0.026 | guide camera plate scale (mm/pixel) |
| PLATSCAL | 217.7358 | plug plate scale (mm/degree) |
| OBJSYS | ICRS | The TCC objSys |
| RA | 321.704 | RA of telescope boresight (deg) |
| DEC | 54.0 | Dec of telescope boresight (deg) |
| RADEG | 321.704 | RA of telescope pointing(deg) |
| DECDEG | 54.0 | Dec of telescope pointing (deg) |
| ROTPOS | 0.0 | Rotator request position (deg) |
| BOREOFFX | 0.0 | TCC Boresight offset, deg |
| BOREOFFY | 0.0 | TCC Boresight offset, deg |
| ARCOFFX | -2e-06 | TCC ObjArcOff, deg |
| ARCOFFY | 1.5e-05 | TCC ObjArcOff, deg |
| OBJOFFX | 0.0 | TCC ObjOff, deg |
| OBJOFFY | 0.0 | TCC ObjOff, deg |
| CALOFFX | 0.0 | TCC CalibOff, deg |
| CALOFFY | 0.0 | TCC CalibOff, deg |
| CALOFFR | 0.0 | TCC CalibOff, deg |
| GUIDOFFX | 0.0 | TCC GuideOff, deg |
| GUIDOFFY | 0.0 | TCC GuideOff, deg |
| GUIDOFFR | 0.000375 | TCC GuideOff, deg |
| AZ | 222.786 | Azimuth axis pos. (approx, deg) |
| ALT | 50.742 | Altitude axis pos. (approx, deg) |
| IPA | 76.628 | Rotator axis pos. (approx, deg) |
| SPA | -103.2929863485145 | TCC SpiderInstAng |
| FOCUS | 0.0 | User-specified focus offset (um) |
| M2PISTON | 1178.44 | TCC SecOrient |
| M2XTILT | -3.91 | TCC SecOrient |
| M2YTILT | -8.99 | TCC SecOrient |
| M2XTRAN | 10.2 | TCC SecOrient |
| M2YTRAN | 121.63 | TCC SecOrient |
| M1PISTON | 0.0 | TCC PrimOrient |
| M1XTILT | -3.04 | TCC PrimOrient |
| M1YTILT | 5.26 | TCC PrimOrient |
| M1XTRAN | 277.7 | TCC PrimOrient |
| M1YTRAN | 178.07 | TCC PrimOrient |
| SCALE | 1.0 | User-specified scale factor |
| FF | 0 0 0 0 | FF lamps 1:on 0:0ff |
| NE | 0 0 0 0 | NE lamps 1:on 0:0ff |
| HGCD | 0 0 0 0 | HGCD lamps 1:on 0:0ff |
| FFS | 0 0 0 0 0 0 0 0 | Flatfield Screen 1:closed 0:open |
| NAME | 3513-55196-01 | The name of the currently loaded plate |
| PLATEID | 3513 | The currently loaded plate |
| CARTID | 6 | The currently loaded cartridge |
| MAPID | 1 | The mapping version of the loaded plate |
| POINTING | B | The currently specified pointing |
| DRA | -2.995321980411232e-06 | measured offset in RA, deg |
| DDEC | 2.545327581529287e-05 | measured offset in Dec, deg |
| DROT | 0.0007499021709283731 | measured rotator offset, deg |
| DFOCUS | -99999.9 | measured focus offset, um |
| DSCALE | 6.706518758485755e-06 | measured scale offset, % |
| FILTRA | 1.797193188246739e-06 | filtered offset in RA, deg |
| FILTDEC | -1.527196548917572e-05 | filtered offset in Dec, deg |
| FILTROT | -0.0003749510854641866 | filtered rotator offset, deg |
| FILTFCUS | -99999.9 | filtered focus offset, um |
| FILTSCLE | -3.353259379242878e-06 | filtered scale offset, % |
| OFFRA | 1.797193188246739e-06 | applied offset in RA, deg |
| OFFDEC | -1.527196548917572e-05 | applied offset in Dec, deg |
| OFFROT | -0.0003749510854641866 | applied rotator offset, deg |
| OFFFOCUS | -99999.9 | applied focus offset, um |
| OFFSCALE | 0.0 | applied scale offset, % |



### HDU1: 
The mask for the calibrated guide image. The bit planes are:

    (bit 0) Saturated pixels. As of guiderActor v1_4_0, pixels above 0xF000 are
    flagged in the unprocessed image and replaced with 0xF000, and those flags
    are carried through the processing steps.
    (bit 1) Bad/negative pixels. Hot/dead pixels, negative value pixels post-processing, etc.
    (bit 2) Pixels outside the guide probes ("blank" regions). Not available in
    v1_0_9 and earlier.
This HDU has no non-standard required keywords.
Data: FITS image

#### HDU Type: IMAGE
#### HDU Size:  256 KB

##### Header Table Caption for HDU1
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | binary table extension |
| BITPIX | 8 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 512 | length of dimension 1 |
| NAXIS2 | 512 | length of dimension 2 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU2: 
Postage stamp images for the small guide probes, where each postage stamp image has been rotated so that north is up and east is to the right. Each postage stamp is square. Extra pixels (pixels around the edge that are not computed from the camera image), if any, are set to the estimated background. The full image is one tall, skinny image comprised of the postage stamps, in order of increasing probe number starting from row=y=0.
This HDU has no non-standard required keywords.
Data: FITS image

#### HDU Type: IMAGE
#### HDU Size:  6 KB

##### Header Table Caption for HDU2
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | binary table extension |
| BITPIX | 16 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 19 | length of dimension 1 |
| NAXIS2 | 171 | length of dimension 2 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU3: 
Masks associated with the postage stamp images for the small guide probes, in
the same format as <a href="#hdu2">HDU2</a>. The mask bits are the same as described in <a href="#hdu1">HDU1</a>
This HDU has no non-standard required keywords.
Data: FITS image

#### HDU Type: IMAGE
#### HDU Size:  3 KB

##### Header Table Caption for HDU3
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | binary table extension |
| BITPIX | 8 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 19 | length of dimension 1 |
| NAXIS2 | 171 | length of dimension 2 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU4: 
Postage stamp images of the large acquisition probes, in the same format as
<a href="#hdu2">HDU2</a>
This HDU has no non-standard required keywords.
Data: FITS image

#### HDU Type: IMAGE
#### HDU Size:  3 KB

##### Header Table Caption for HDU4
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | binary table extension |
| BITPIX | 16 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 29 | length of dimension 1 |
| NAXIS2 | 58 | length of dimension 2 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU5: 
Masks for the images in <a href="#hdu4">HDU4</a>, similar to <a href="hdu3">HDU3</a>.
This HDU has no non-standard required keywords.
Data: FITS image

#### HDU Type: IMAGE
#### HDU Size:  1 KB

##### Header Table Caption for HDU5
Key | Value | Comment | |
| --- | --- | --- | --- |
| XTENSION | IMAGE | binary table extension |
| BITPIX | 8 | array data type |
| NAXIS | 2 | number of array dimensions |
| NAXIS1 | 29 | length of dimension 1 |
| NAXIS2 | 58 | length of dimension 2 |
| PCOUNT | 0 | number of group parameters |
| GCOUNT | 1 | number of groups |



### HDU6: 
A binary table containing information about the guide probes and guide stars.
Each entry is for one guide probe; data is listed in probe number order
starting from 1.
Definitions of the various guide probe bits:
GOOD   =  0x00     # A happy, working, in-use probe has all bits set to 0.
BROKEN =  0x01     # a known broken probe, labeled as such in plPlugMap
NOSTAR =  0x02     # probe with no star in plPlugMap (e.g. tritium)
DISABLED = 0x04     # probe that has been disabled by the observers (e.g. no star present, double star, wrong position)
ABOVEFOCUS = 0x08  # fiber is above the focal plane
BELOWFOCUS = 0x10  # fiber is below the focal plane
TOOFAINT = 0x20    # observed star is too faint to be reliably used for guiding
UNKNOWN = 0xff     # shouldn't ever happen
This HDU has no non-standard required keywords.
<b>Additional notes on fiber rotation angles:</b>
The rotStar2Sky value is the primary angle needed to interpret an individual
fiber image. The postage stamps are rotated such that North is up, with
<code>
rotStar2Sky = 90 + rotation - phi
</code>
where phi is the angle of the guide fiber alignment hole on the plate measured
clockwise from North. phi comes from the plPlugmap file for that plate and is
calculated from the relative (x,y) coordinates of the guide fiber hole and the
alignment hole. The rotation keyword is loaded from platedb, and is also
recorded in the <code>etc/gcamFiberInfo.par</code> file in the guiderActor
product.

#### HDU Type: BINARY TABLE
#### HDU Size:  1 KB

##### Binary Table Caption for HDU6
Name | Type | Unit | Description |
| --- | --- | --- | --- |
 | EXISTS | bool | migration: unit of keyword/column not found. Needs update | Does this probe exist? |
 | ENABLED | bool | migration: unit of keyword/column not found. Needs update | Was this probe enabled for guiding for this image? |
 | FLAGS | bool | migration: unit of keyword/column not found. Needs update | migration: description of keyword/column not found. Needs update |
 | XFOCAL | float32 | plate mm | Center of guide probe on plug plate |
 | YFOCAL | float32 | plate mm | Center of guide probe on plug plate |
 | XCENTER | float32 | guidercam pixels (binned) | Center of guide probe on image |
 | YCENTER | float32 | guidercam pixels (binned) | Center of guide probe on image |
 | RADIUS | float32 | guidercam pixels (binned) | Radius of guide probe active area on image |
 | XFERRULEOFFSET | float32 | migration: unit of keyword/column not found. Needs update | Offset of guide probe active area w.r.t the ferrule |
 | YFERRULEOFFSET | float32 | migration: unit of keyword/column not found. Needs update | Offset of guide probe active area w.r.t the ferrule |
 | ROTATION | float32 | degrees | Intrinsic rotation of guide probe measured counter clockwise from the guider x axis to the guide probe alignment pin direction. |
 | ROTSTAR2SKY | float32 | degrees | Rotation of a guide fiber image on the guide camera (measured counter clockwise from the guider x axis North). Rotation of the guide fiber image by -rotStar2Sky produces a North up image. |
 | FOCUSOFFSET | float32 | micrometers | Focus offset of guide probe; + is further from the secondary (shorter ferrule) |
 | FIBER_TYPE | char[20] | migration: unit of keyword/column not found. Needs update | Type of guide probe: one of <code>(ACQUIRE|GUIDE|TRITIUM)</code> |
 | XSTAR | float32 | guidercam pixels (binned) | Centroid of star on image |
 | YSTAR | float32 | guidercam pixels (binned) | Centroid of star on image |
 | DX | float32 | mm, guidercam frame | Centroid of star - center of guide probe on image |
 | DY | float32 | mm, guidercam frame | Centroid of star - center of guide probe on image |
 | DRA | float32 | mm, plate frame | Centroid of star - center of guide probe along RA/Dec |
 | DDEC | float32 | mm, plate frame | Centroid of star - center of guide probe along RA/Dec |
 | FWHM | float32 | arcsec | FWHM of star |
 | POSERR | float32 | guidercam pixels (binned) | Estimate of the centroiding error of star |
 | STAMPSIZE | int16 | migration: unit of keyword/column not found. Needs update | Index of postage stamp HDU: 1=HDU4 (small), 2=HDU4 (large), 0=none (Tritium source) |
 | STAMPIDX | int16 | migration: unit of keyword/column not found. Needs update | Index of postage stamp: 0 for the postage stamp starting at x=0, -1 if no postage stamp (e.g. Tritium source or unavailable guide probe). |


